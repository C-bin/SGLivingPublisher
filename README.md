iOS不用任何第三方写一个简单的RTMP直播推流器

>2016年是移动直播爆发年，不到半年的时间内无数移动直播App掀起了全民直播的热潮。然而个人觉得直播的门槛相对较高,从推流端到服务端到播放端,无不需要专业的技术来支撑,仅仅推流端就有不少需要学习的;目前大部分直播采用的都是RTMP协议,我这里写一个简单的Demo,帮助大家更好的理解直播推流的过程,主要包括:音视频采集,音视频编码,数据打包,RTMP协议相关的知识等.项目结构分的很清楚,各个模块也用协议进行了分离,方便大家学习不同的模块.

* `SGSimpleSession` 是Api接口层,负责对外提供可直接调用的接口,同时也是一个数据处理中心,音视频数据获取后和编码后都在这里被分发到不同的类进行处理.

* **视频相关的类**

	* `SGVideoSource`  原始视频数据获取类,用AVFoundation类对外提供原始未经编码的的视频数据(一帧一帧的数据,可以提取出图像),同时提供图像预览功能.如果需要添加美颜,摄像头切换,翻转,闪光灯等操作,直接改这个类就可以了.

	* `SGVideoConfig` 这个视频配置的类,主要包括压缩等级,分辨率,码率等的设置

	* `SGH264Encoder` 这个类是编码器,主要功能是对原始的视频帧进行编码压缩处理,这里采用的是`硬编码`,编码输出格式为H264格式.

	* `SGH264Packager` 这个类负责对已经编码好的H264帧数据进行打包处理,打包成符合RTMP协议格式的数据,然后才能发送.

* 音频相关类
	* `SGAudioSource` 这个类主要负责录制音频数据,输出原始音频帧,音频的格式为PCM格式.
	*`SGAudioConfig` 这个类是音频配置相关的类,主要包括声道数,码率,采样率的配置.
	* `SGAACEncoder` 这个类作用是将原始PCM音频数据进行编码压缩,编码结果为AAC格式的音频数据.
	* `SGAACPackager` 这个了类作用是将编码后的AAC格式数据大波按成符合RTMP协议的数据.
	* `SGStreamSession`这个类主要是用来建立tcp连接,底层数据的读取和发送,以及连接状态的回调.
	* `SGRtmpSession`这个类主要与RTMP相关,主要负责与服务器交互,包括RTMp握手,指令的发送,对数据的进一步封装,封装成消息,然后再发送.

以上就是整个项目的基本结构,整个过程类似工厂流水线,可以自行对各个模块进行替换和研究.demo中注释也不少,方便理解.

附上完整的代码:<https://github.com/iOSSinger/SGLivingPublisher>
附上RTMP中文文档:<https://github.com/iOSSinger/imageRepository/raw/master/RTMP.docx>
附上学习博客:
雷晓华博士的博客:这个是非常好的视音频开发技术文章,喜欢视音频的可以看看<http://blog.csdn.net/leixiaohua1020>

硬编码的详细说明:<http://www.jianshu.com/p/a6530fa46a88>









































